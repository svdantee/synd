{% extends "base.html" %}

{% block title %}平台公告 - 文档评审系统{% endblock %}

{% block content %}
<div class="page-header">
    <h1>平台公告</h1>
</div>

<div class="form-card" style="margin-bottom: 2rem;">
    <form method="POST">
        <div class="form-group">
            <label for="title">公告标题 *</label>
            <input type="text" id="title" name="title" required>
        </div>
        <div class="form-group">
            <label for="content">公告内容 *</label>
            <textarea id="content" name="content" rows="6" required></textarea>
        </div>
        <div class="form-group">
            <label>
                <input type="checkbox" name="is_published" checked>
                立即发布
            </label>
        </div>
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">发布公告</button>
            <a href="javascript:history.back()" class="btn btn-secondary">返回</a>
        </div>
    </form>
</div>

<div class="section">
    <h2>公告列表</h2>
    <div class="table-container">
        <table class="data-table">
            <thead>
            <tr>
                <th>标题</th>
                <th>状态</th>
                <th>发布时间</th>
                <th>操作</th>
            </tr>
            </thead>
            <tbody>
            {% for a in announcements %}
            <tr>
                <td>{{ a.title }}</td>
                <td>{{ '已发布' if a.is_published else '未发布' }}</td>
                <td>{{ a.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                <td>
                    <button class="btn btn-sm btn-danger" onclick="deleteAnn({{ a.id }})">删除</button>
                </td>
            </tr>
            {% else %}
            <tr><td colspan="4" class="text-center">暂无公告</td></tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function deleteAnn(id) {
    if (!confirm('确定删除该公告？')) return;
    fetch(`/admin/announcements/${id}/delete`, { method: 'POST' })
        .then(r => r.json())
        .then(res => {
            if (res.success) location.reload();
            else alert('删除失败');
        });
}
</script>
{% endblock %}


